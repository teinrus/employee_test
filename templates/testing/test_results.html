{% extends 'testing/base.html' %}
{% load custom_filters %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞{% endblock %}

{% block content %}
    <h2 class="text-center">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h2>

    <p><strong>–§–∞–º–∏–ª–∏—è:</strong> {{ result.surname }}</p>
    <p><strong>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> {{ result.direction.name }}</p>
    <p><strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</strong> {{ result.correct_answers }} –∏–∑ {{ result.total_questions }}</p>

    <hr>

    <h3>–ü–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>

    <style>
        .theme-block {
            background-color: #f8f9fa; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω */
            border-left: 5px solid #CB272B; /* –ö—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è —Å–ª–µ–≤–∞ */
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .question-block {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .theme-title {
            font-size: 20px;
            font-weight: bold;
            color: #103D6E; /* –¢—ë–º–Ω–æ-—Å–∏–Ω–∏–π */
            margin-bottom: 10px;
        }
    </style>

    {% for theme, questions in questions_by_theme.items %}
        <div class="theme-block">
            <h3 class="theme-title">{{ theme.name }}</h3>

            {% for question in questions %}
                <div class="question-block">
                    <p><strong>–í–æ–ø—Ä–æ—Å:</strong> {{ question.text }}</p>
                    <ul class="list-group">
                        {% with selected_answer=user_answers|get_item:question.id %}
                            {% for answer in question.answers.all %}
                                {% if selected_answer is not None %}
                                    {% if answer.id == selected_answer %}
                                        {% if answer.is_correct %}
                                            <li class="list-group-item text-success fw-bold">
                                                ‚úÖ <strong>–í–∞—à –æ—Ç–≤–µ—Ç (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):</strong> {{ answer.text }}
                                            </li>
                                        {% else %}
                                            <li class="list-group-item text-danger fw-bold">
                                                ‚ùå <strong>–í–∞—à –æ—Ç–≤–µ—Ç (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):</strong> {{ answer.text }}
                                            </li>
                                        {% endif %}
                                    {% elif answer.is_correct %}
                                        <li class="list-group-item text-success fw-bold">
                                            ‚úÖ <strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong> {{ answer.text }}
                                        </li>
                                    {% else %}
                                        <li class="list-group-item">{{ answer.text }}</li>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endwith %}
                    </ul>
                </div>
            {% endfor %}
        </div>
    {% endfor %}

    <a href="{% url 'pdf_results' result.id %}" class="btn btn-danger mt-3">
        üìÑ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PDF
    </a>

{% endblock %}
